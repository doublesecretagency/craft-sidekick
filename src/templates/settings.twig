{% import '_includes/forms' as forms %}

<h2>Sidekick Settings</h2>

{# Field to be referenced in the settings #}
{% set key = 'openAiApiKey' %}

{# Link to documentation for adding an API key #}
{% set docsUrl = 'https://plugins.doublesecretagency.com/sidekick/getting-started/settings#openai-api-key' %}

{# Determine whether a config value is set #}
{% set configOverride = (key in configFile|keys) %}

{# Config override warning message #}
{% set message = "This is being set in the config file. [{file}]"|t('sidekick', {
    file: '`config/sidekick.php`'
}) %}

{# Configure the field #}
{% set config = {
    label: "OpenAI API Key"|t('sidekick'),
    id: 'openAiApiKey',
    name: 'openAiApiKey',
    instructions: "Enter your key here. [Learn how to get an API key...](#{docsUrl})",
    value: ((configFile[key] ?? settings[key] ?? null) ?: null),
    disabled: configOverride,
    warning: (configOverride ? message),
    suggestEnvVars: not configOverride
} %}

{# Render input field #}
{{ forms.autosuggestField(config) }}

{# Recommendation to use environment variable #}
<div class="readable">
    <blockquote class="note warning">
        <p>For enhanced security, we highly recommend using an <strong>environment variable</strong> to store your API key.</p>
        <p>Doing so will protect the key from being recorded in either the database or project config YAML files.</p>
    </blockquote>
</div>
